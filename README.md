# Учебный проект рекомендательной системы

Проект представляет собой сервис рекомендации фильмов на основе поведения пользователей. Сервис включает пользовательский интерфейс и REST API для взаимодействия с бэкендом. 
![image](https://github.com/user-attachments/assets/6755e164-aa11-4aa8-a5f5-ebd1902ccc92)

# Описание

Проект состоит из нескольких частей, подробнее можно ознакомиться в файле `docker-compose.yml`.


![image](https://github.com/user-attachments/assets/5321c54e-645c-42a9-85e4-fbf090b7ccc4)



- **frontend**  - Простой веб-интерфейс. Работает на 8000 порту. Состоит из сетки фильмов с кнопками лайка и дизлайка. При нажатии кнопки на стороне фронтенда генерируется запрос на бэкенд для сохранения действия пользователя.
- **event collector** - Сервер, написанный на FastAPI. Работает на 5000 порту. Имеет два эндпоинта:
  
  `/interact` - принимает запрос с фронтенда о действии пользователя и отправляет его в RabbitMQ и Redis
  
  `/healthcheck` - мониторинг состояния
- **rabbitmq** - Брокер сообщений. Был выбран из-за удобства пользования и небольшого объема данных. Записывает и хранит сообщения из *event collector*. Работает на 5672 порту, имеет также веб-интерфейс на 15672 порту.
- **ml-pipeline** - набор скриптов для построения рекомендаций. Состоит из нескольких асинхронных функций, выполняющих следующие функции:
1. Чтение сообщений из RabbitMQ и сохранение данных
2. Подсчет наиболее популярных фильмов на основе пользовательского взаимодействия
3. Обучение модели Word2Vec из библиотеки `gensim`, подбор гиперпараметров с помощью библиотеки `optuna`, подготовка на основе модели персональных рекомендаций

    В виду того, что проект учебный, есть ряд особенностей. В качестве хранилища истории взаимодействий пользователей выступает обычный .csv файл, а в качестве планировщика повторяющихся задач используется библиотека `asyncio`.
- **redis** - используется для быстрого доступа к рекомендациям и истории пользовательского взаимодействия. Работает на 6379 порту, имеет также веб-интерфейс на 5540 порту.
- **backend-recs** - Сервер для получения рекомендаций, написанный на FastAPI. Работает на 5001 порту. Имеет несколько эндпоинтов:

  `/recs/{user_id}` - возвращает рекомендацию для конкретного пользователя. Имеет следующие приоритеты для рекомендаций: персональные > популярные фильмы > рандомные фильмы. Если по каким-то причинам (новый пользователь или только запущенный сервис) не удается получить приоритетные рекомендации, то берутся/дополняются из рекомендаций ниже приоритетом. Также с определнным шансом для увеличения покрытия могут порекомендоваться рандомные фильмы. В конце рекомендации проверяются на новизну: если пользователь раньше взаимодействовал с данным фильмом, то он исключается из рекомендаций.

  `/add_items` - использовалась для тестов

  `/healthcheck` - мониторинг состояния

  `/cleanup` - полная очистка RabbitMQ и Redis. Использовалась для тестов

# Запуск 
Для запуска необходим Docker. 
1) Клонируем репозиторий `git clone https://github.com/Adgius/recsys.git`
2) Меням адрес event collector `SERVICE_API_URL` в файле *.env* на адрес хоста. Для локального использования можно оставить `http://localhost:5000`
3) В корне проекта пишем `docker compose up`

В файле *.env* хранятся учетные данные для входа в веб-интерфейс RabbitMQ и Redis.

При первом запуске скачаются картинки для фильмов из Object Storage Yandex Cloud. Возможно в будущем они будут удалены из хранилища. 
